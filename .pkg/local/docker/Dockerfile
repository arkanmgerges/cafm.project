FROM python:3.8-slim

RUN apt update
RUN pip3 install --upgrade pip && pip3 install pipenv && pip3 install hupper

# -- Adding Pipfiles
COPY Pipfile Pipfile.lock ./
# -- Install dependencies:
RUN set -ex && pipenv install --dev --deploy --system
COPY . /app

ENV CAFM_PROJECT_LOGGING=DEBUG
ENV DECORATOR_DEBUGGING_INFO_STATUS=True
ENV CAFM_PROJECT_LOGGING_MAX_FILE_LINES=7
ENV OPEN_TELEMETRY_IS_RUNNING=True
ENV SECRET_TOKEN=1EACFC47-FFDD-4CB9-9C45-3A53998C1FA8
ENV MESSAGE_BROKER_SERVERS='kafka:9092'
ENV KAFKA_PARTITIONS_COUNT_PER_TOPIC=1
ENV MESSAGE_SCHEMA_REGISTRY_URL='http://schema-registry:9001'
ENV CAFM_API_COMMAND_TOPIC='cafm.api.cmd'
ENV CAFM_API_RESPONSE_TOPIC='cafm.api.rsp'
ENV CAFM_API_SERVICE_NAME='cafm.api'
ENV CAFM_IDENTITY_SERVICE_NAME='cafm.identity'
ENV CAFM_IDENTITY_EVENT_TOPIC='cafm.identity.evt'
ENV CAFM_PROJECT_CONSUMER_GROUP_API_CMD_NAME='cafm.project.consumer-group.api.cmd'
ENV CAFM_PROJECT_CONSUMER_GROUP_IDENTITY_EVT_NAME='cafm.project.consumer-group.identity.evt'
ENV CAFM_PROJECT_CONSUMER_GROUP_PROJECT_CMD_NAME='cafm.project.consumer-group.project.cmd'
ENV CAFM_PROJECT_CONSUMER_GROUP_PROJECT_FAILED_CMD_HANDLE_NAME='cafm.project.consumer-group.failed-cmd-handle'
ENV CAFM_PROJECT_FAILED_LOOKUP_EVENT_HANDLE_TOPIC='cafm.project.failed-lookup-evt-handle'
ENV CAFM_PROJECT_CONSUMER_GROUP_LOOKUP_PROJECT_EVENT_NAME='cafm.project.consumer-group.lookup-project.evt'
ENV CAFM_PROJECT_CONSUMER_GROUP_PROJECT_FAILED_LOOKUP_EVENT_HANDLE_NAME='cafm.project.consumer-group.failed-lookup-evt-handle'
ENV CAFM_PROJECT_CONSUMER_GROUP_IDENTITY_FAILED_EVT_HANDLE_NAME='cafm.project.consumer-group.identity-failed-evt-handle'
ENV CAFM_PROJECT_CONSUMER_GROUP_FAILED_CMD_HANDLE_NAME='cafm.project.consumer-group.failed-cmd-handle'
ENV CAFM_PROJECT_IDENTITY_FAILED_EVENT_HANDLE_TOPIC='cafm.project.identity-failed-evt-handle'
ENV CAFM_PROJECT_FAILED_COMMAND_HANDLE_TOPIC='cafm.project.failed-cmd-handle'
ENV CAFM_PROJECT_SERVICE_NAME='cafm.project'
ENV CAFM_PROJECT_COMMAND_TOPIC='cafm.project.cmd'
ENV CAFM_PROJECT_EVENT_TOPIC='cafm.project.evt'
ENV CAFM_IDENTITY_FAILED_EVENT_HANDLE_TOPIC='cafm.project.identity-failed-evt-handle'
ENV CAFM_JWT_SECRET='cafmpass1234'
ENV CAFM_PROJECT_REDIS_HOST='redis'
ENV CAFM_PROJECT_REDIS_PORT=6379
ENV CAFM_PROJECT_REDIS_SESSION_KEY_PREFIX='cafm.project.session.'
ENV CAFM_PROJECT_DB_USER='root'
ENV CAFM_PROJECT_DB_PASSWORD='&g4hip!fL8$9sQpG'
ENV CAFM_PROJECT_DB_HOST='mysql'
ENV CAFM_PROJECT_DB_PORT=3306
ENV CAFM_PROJECT_DB_NAME='cafm-project'
ENV JAEGER_HOST=jaeger
ENV JAEGER_THRIFT_AGENT_PORT=6831
ENV CAFM_PROJECT_ELASTICSEARCH_HOST='elasticsearch'
ENV CAFM_PROJECT_ELASTICSEARCH_PORT=9200