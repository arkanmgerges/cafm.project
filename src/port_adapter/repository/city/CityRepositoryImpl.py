"""
The file is generated by a scaffold script
@author: Arkan M. Gerges<arkan.m.gerges@gmail.com>
"""

from src.application.lifecycle.ApplicationServiceLifeCycle import ApplicationServiceLifeCycle
from src.domain_model.city.City import City
from src.domain_model.city.CityRepository import CityRepository
from src.domain_model.resource.exception.CityDoesNotExistException import CityDoesNotExistException
from src.port_adapter.repository.db_model.City import City as DbCity
from src.resource.logging.decorator import debugLogger


class CityRepositoryImpl(CityRepository):
    @debugLogger
    def cityById(self, id: int) -> City:
        dbSession = ApplicationServiceLifeCycle.dbContext()
        dbObject = dbSession.query(DbCity).filter_by(geoNameId=id).first()
        if dbObject is None:
            raise CityDoesNotExistException(f"id = {id}")
        return City.createFrom(id=dbObject.geoNameId, name=dbObject.cityName)


    def _updateDbObjectByObj(self, dbObject: DbCity, obj: City):
        dbObject.name = obj.name() if obj.name() is not None else dbObject.name
        return dbObject

    def _createDbObjectByObj(self, obj: City):
        return DbCity(id=obj.id(), name=obj.name())
