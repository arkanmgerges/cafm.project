"""
The file is generated by a scaffold script
@author: Arkan M. Gerges<arkan.m.gerges@gmail.com>
"""

{%set className= model.name | upperCamelCase%}
{%-set lowerCamelModelName= model.name | lowerCamelCase-%}
{%-set funcParams= model.field | mapFuncParams-%}
{%-set funcArgs= model.field | mapFuncArgs-%}
{%-set funcArgsByObj= model.field | mapFuncArgs('obj', 'function')-%}
{%-set funcArgsByDbObj= model.field | mapFuncArgs('dbObject')-%}
{%-set funcArgsByItem= model.field | mapFuncArgs('x')-%}
{%-set classNameWords= model.name | spacedWords%}
{%-set filePath= model.path | replace('/', '.')%}

from elasticsearch_dsl import InnerDoc, Keyword
from src.port_adapter.repository.es_model.model.EsModelAttributeData import EsModelAttributeData


class {{ model.domain_model.name | upperCamelCase }}(InnerDoc):
    {%- for field in model.field %}
    {%- if field.type == "foreign" %}
    {{ field.name }} = Nested({{ field.link.domain_model.name | upperCamelCase }})
    {%- else %}
    {{ field.name }} = {{ field.es.type }}()
    {%- endif %}
    {%- endfor %}

    @classmethod
    def attributeDataBySnakeCaseAttributeName(cls, instance: '{{ model.domain_model.name | upperCamelCase }}' = None, snakeCaseAttributeName: str = None) -> EsModelAttributeData:
        # Remove any dots for nested objects, e.g. country.id should become country
        periodIndex = snakeCaseAttributeName.find('.')
        if periodIndex != -1:
            snakeCaseAttributeName = snakeCaseAttributeName[:periodIndex]
        mapping = {
        {%- for field in model.field %}
        {%- if field.type == "foreign" %}
            "{{ field.name }}": EsModelAttributeData(attributeModelName='{{ field.name | lowerCamelCase }}', attributeRepoName='{{ field.name }}', attributeRepoValue=Util.deepAttribute(instance, '{{ field.name }}', None), dataType={{ field.link.domain_model.name | upperCamelCase }}, isClass=True),
        {%- else %}
            {%- if field.es.type == "Integer" %}
            "{{ field.name }}": EsModelAttributeData(attributeModelName='{{ field.name | lowerCamelCase }}', attributeRepoName='{{ field.name }}', attributeRepoValue=getattr(instance, '{{ field.name }}', None)), dataType=int,
            {%- elif field.es.type == "Float" %}
            "{{ field.name }}": EsModelAttributeData(attributeModelName='{{ field.name | lowerCamelCase }}', attributeRepoName='{{ field.name }}', attributeRepoValue=getattr(instance, '{{ field.name }}', None)), dataType=float,
            {%- elif field.es.type == "Date" %}
            "{{ field.name }}": EsModelAttributeData(attributeModelName='{{ field.name | lowerCamelCase }}', attributeRepoName='{{ field.name }}', attributeRepoValue=getattr(instance, '{{ field.name }}', None)), dataType=datetime,
            {%- elif field.es.type == "Boolean" %}
            "{{ field.name }}": EsModelAttributeData(attributeModelName='{{ field.name | lowerCamelCase }}', attributeRepoName='{{ field.name }}', attributeRepoValue=getattr(instance, '{{ field.name }}', None)), dataType=bool,
            {%- else %}
            "{{ field.name }}": EsModelAttributeData(attributeModelName='{{ field.name | lowerCamelCase }}', attributeRepoName='{{ field.name }}', attributeRepoValue=getattr(instance, '{{ field.name }}', None)),
            {%- endif %}
        {%- endif %}
        {%- endfor %}
        }

        return mapping[snakeCaseAttributeName] if snakeCaseAttributeName in mapping else None